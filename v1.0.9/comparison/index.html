<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linear vs. Monte-Carlo uncertainty propagation · MonteCarloMeasurements Documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="MonteCarloMeasurements Documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit">MonteCarloMeasurements Documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../overloading/">Supporting new functions</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Linear vs. Monte-Carlo uncertainty propagation</a><ul class="internal"><li><a class="tocitem" href="#Pendulum-simulation-1"><span>Pendulum simulation</span></a></li></ul></li><li><a class="tocitem" href="../performance/">Performance tips</a></li><li><a class="tocitem" href="../advanced_usage/">Advanced usage</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Linear vs. Monte-Carlo uncertainty propagation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linear vs. Monte-Carlo uncertainty propagation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/baggepinnen/MonteCarloMeasurements.jl/blob/master/docs/src/comparison.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Comparison-between-linear-uncertainty-propagation-and-Monte-Carlo-sampling-1"><a class="docs-heading-anchor" href="#Comparison-between-linear-uncertainty-propagation-and-Monte-Carlo-sampling-1">Comparison between linear uncertainty propagation and Monte-Carlo sampling</a><a class="docs-heading-anchor-permalink" href="#Comparison-between-linear-uncertainty-propagation-and-Monte-Carlo-sampling-1" title="Permalink"></a></h1><p>This page will highlight some situations in which linear uncertainty propagation breaks down by showing the input density along the x-axis and the various approximations to the output density on the y-axis. The figures will be similar to the one below, but we&#39;ll leave out some of the guiding lines and particles for clarity <img src="../assets/transformed_densities.svg" alt="transformed densities"/></p><p>All examples will use Gaussian input densities since linear uncertainty propagation is only applicable in this case.</p><p>We start by defining a function that plots everything for us</p><pre><code class="language-julia">using MonteCarloMeasurements, Measurements, Plots, Distributions
using Measurements: value, uncertainty

function plot_dens(f, d, l, r, N=10_000; kwargs...)
    xr = LinRange(l,r,100) # x values for plotting
    yr = f.(xr)

    # Estimate the output density corresponding to the particles
    x  = Particles(N,d) # Create particles distributed according to d, sort for visualization
    yp = f(x)
    y  = yp.particles # corresponding output particles
    edges1, edges2 = Plots._hist_edges((xr,y), 30)
    histogram(fill(l, length(y)), y , bins=edges2, orientation=:h, alpha=0.4, normalize=true, lab=&quot;Particle density&quot;)

    fig = plot!(xr.-l, yr, legend=:right, xlims=(0,r-l), axis=false, grid=false, lab=&quot;f(x)&quot;, xlabel=&quot;Input space&quot;, ylabel=&quot;Output space&quot;, l=(3,:blue))
    idens = pdf.(d,xr)
    idens .*= maximum(yr)/maximum(idens)
    plot!(xr.-l,idens; lab=&quot;Input dens.&quot;, l=(:orange, ), kwargs...)


    # This is the output density as approximated by linear uncertainty propagation
    my   = f(Measurements.:±(mean(d), std(d))) # output measurement
    if uncertainty(my) == 0 # Draw a stick
        plot!([0,0+(r-l)/3], [value(my),value(my)], m=(:o,), lab=&quot;Linear Gaussian propagation&quot;)
    else
        yxr  = LinRange(value(my)-2.5uncertainty(my),value(my)+2.5uncertainty(my),100)
        dm   = Normal(value(my), uncertainty(my)) # Output density according to Measurements
        ym   = pdf.(dm,yxr)
        ym .*= 0+(r-l)/3/maximum(ym)
        plot!(0 .+ ym, yxr, lab=&quot;Linear Gaussian propagation&quot;)
    end
    fig
end</code></pre><pre><code class="language-none">plot_dens (generic function with 2 methods)</code></pre><p>The first example we&#39;ll look at is the quadratic parabola. This function will be poorly approximated by a linear function around <span>$x=0$</span>.</p><pre><code class="language-julia">plot_dens(x-&gt;x^2+3, Normal(0,1), -3, 3, legend=:top)</code></pre><object type="text/html" data="../parabola.html" style="width:100%;height:450px;"></object><p>as we can see, the linear method outputs a Dirac distribution (no uncertainty) at <span>$x=0$</span>, while there should clearly be a lot of uncertainty in the output. The histogram displays the output density as approximated by the particles. The histogram does not go below zero, and tapers off as values increase. The problem here is that the uncertainty is large in relation to the curvature of the function. As the uncertainty decreseas, the true output density becomes closer and closer to a DIrac distribution.</p><p>The next function has a discontinuity (≈ infinite curvature)</p><pre><code class="language-julia">plot_dens(x-&gt;sign(x)+1, Normal(0.5,1), -3, 3, legend=:bottomright)</code></pre><object type="text/html" data="../sign.html" style="width:100%;height:450px;"></object><p>once again, linear uncertainty propagation outputs a distribution with zero uncertainty. The true output distribution has two modes since the input distribution has palces mass on both sides of the discontinuity. This is captured in the particle distribution, where most particles end up at the right side of the discontinuity, while a smaller proportion of the particles end up to the left. If the input density would have its mean at 0, half of the particles would end up in each of the output locations. Any funciton containing an if-statment where the chosen branch depends on an uncertain value falls into this category.</p><p>Next, we consider a periodic function</p><pre><code class="language-julia">plot_dens(x-&gt;sin(x)+2, Normal(0.5,1), -3, 3, legend=:topright)</code></pre><object type="text/html" data="../sin.html" style="width:100%;height:450px;"></object><p>Once again, the uncertainty is large in relation to the curvature of the function and linear uncertainty propagation places significant mass outside the interval <span>$[-1, 1]$</span> which is the range of the <span>$\sin$</span> function. The particle histogram respects this range. If we increase the uncertainty in the input further, the linear approximation to the function becomes increasingly worse</p><pre><code class="language-julia">plot_dens(x-&gt;sin(x)+2, Normal(0.5,5), -15, 15, legend=:topright)</code></pre><object type="text/html" data="../sin_wide.html" style="width:100%;height:450px;"></object><h2 id="Pendulum-simulation-1"><a class="docs-heading-anchor" href="#Pendulum-simulation-1">Pendulum simulation</a><a class="docs-heading-anchor-permalink" href="#Pendulum-simulation-1" title="Permalink"></a></h2><p>The example <a href="../examples/#Differential-Equations-1">Differential Equations</a> shows how linear/Monte-Carlo uncertainty propagation through a nonlinear ODE works.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><a class="docs-footer-nextpage" href="../performance/">Performance tips »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 3 July 2022 13:25">Sunday 3 July 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
